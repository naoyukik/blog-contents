---
title: "JetBrains AI AssistantのACPでGemini CLIをチャットに統合する"
emoji: "🤖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["JetBrains", "IntelliJ", "AI", "Gemini"]
published: true
---
JetBrains AI AssistantがACPサーバーに対応しました。
ACP（Agent Client Protocol）は、Zedによって提唱されたAIエージェントとIDEが通信するためのオープンなプロトコルです。

https://agentclientprotocol.com/overview/introduction

https://www.jetbrains.com/help/ai-assistant/acp.html#configure-acp-compatible-agent

AIエージェントとIDE、共にこの規格に沿った実装がされていれば、IDEの統合されたチャットGUI等が使えるようになります。
IntelliJ IDEA 2025.3以降のAI Assistantがこの規格に対応したため、例えばACPに対応したGemini CLIを実行することで、JetBrains AI Assistantのチャットインターフェイスを利用することが可能になりました。

今回は試しにGemini CLIをACP経由でエージェント設定をします。

## Gemini CLIのインストール

ACPは自分でインストール済みのAIエージェントを使用します。

そのため、まずはGemini CLIをグローバルへインストールします。

```bash
npm install -g @google/gemini-cli
```

## ACP 設定

**※ 下記設定はWindowsを想定したものになっています**

設定方法は `Configure ACP Agents` から呼びだしたJSONに下記の設定を追記します。

1. AI Assistant Chatを開きます。
2. 右上のメニュー（3点アイコン）から`Configure ACP Agents` を選択します。
3. `%USERPROFILE%\.jetbrains\acp.json` がエディターで開きます。
4. 下記を設定します。

```json
{
    "agent_servers": {
        "Gemini CLI": {
            "command": "path\\to\\gemini.cmd",
            "args": [
                "--experimental-acp"
            ],
            "use_idea_mcp": true,
            "use_custom_mcp": true
        }
    }
}
```

- commandのpathは `where gemini` で確認可能です

### use_idea_mcp
IntelliJのIDEにプラグインとして導入しているMCPサーバーをエージェントに公開するかを制御する設定。デフォルトではfalse。

このMCPサーバーを使用することによって、IntelliJのIDE機能を外部のAIエージェントから使用可能になります。
例えば、IntelliJが検査したファイルのProblemをAIに渡すことができるようになります。

#### JetBrains MCP Server プラグイン
IntelliJのMCP ServerはIntelliJ IDEA 2025.2からプラグインとして導入されました。

https://www.jetbrains.com/help/ai-assistant/mcp.html#use_ide_as_an_mcp_server

### use_custom_mcp
ユーザーが設定したAI AssistantのMCPサーバーをエージェントに公開するかの制御。 デフォルトではtrue。
自分で設定したMCPを使用する際、この設定を有効にする必要があります。

この設定はuse_idea_mcpと違い、AI Assistantの設定に登録したMCPサーバーを、ACPで設定したエージェントで使えるようにするための設定です。
AI AssistantのMCPサーバーは `File | Settings | Tools | AI Assistant | Model Context Protocol (MCP)` から設定可能です。

その他詳細な設定は公式リファレンスをご確認ください。

https://www.jetbrains.com/help/ai-assistant/acp.html

### その他の設定

その他の設定（例えばMCP設定用のmcp.jsonやGemini CLIの全体的な設定用のsettings.json等）はほぼ不要です。

検証した範囲では、settings.jsonで設定したモデル名は反映されていました。
他のどの設定が反映されているかは未検証です。

## 確認

設定ができたら、AI Assistant Chatを開き、エージェント選択で `Gemini CLI` が表示されているか確認してください。
表示されていれば成功です。

![select agents](/images/select-agents.png)

Gemini CLIを選択するとGemini CLIのACPサーバーが立ち上がり、チャットに接続されます。
Gemini CLIは起動がやや遅いので、エラーが発生することがあります。その場合でも、何度かNew Chatを繰り返すと接続されます。

接続完了後、自己紹介等の簡単なやりとりを試してみてください。

# まとめ

今回はJetBrainsが対応したACPを使ったエージェント対応について説明しました。
もしGemini CLIやその他のACP対応のエージェントをチャットインターフェイスを介して使いたい場合は、設定してみてはいかがでしょうか。
