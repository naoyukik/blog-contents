---
title: "Debianï¼ˆWSL2ï¼‰+Dockerã®ç’°å¢ƒæ§‹ç¯‰"
emoji: "ğŸŒ€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["WSL","Debian","Docker","PhpStorm"]
published: true
---
WSL 2ä¸Šã«Debianã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸéš›ã®æ·¡ã€…ã¨ã—ãŸè¨˜éŒ²ã§ã™ã€‚

## ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
$ sudo apt update && sudo apt dist-upgrade
$ sudo apt install wget curl make git vim
$ /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
$ echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> ~/.profile
$ curl https://get.volta.sh | bash
$ source ~/.profile
$ brew install tfenv
$ tfenv install latest
$ tfenv use latest
$ volta install node@lts
$ volta install pnpm
```


## Docker Desktop for Windowsã¨ã®é€£æº
1. Settings | Resources | WSL INTEGRATION
2. Enable integration with additional distros: ã§ä½¿ã„ãŸã„ãƒ‡ã‚£ã‚¹ãƒˆãƒ­ã‚’ON

ä¸€ç•ªã‚„ã‚ŠãŸã‹ã£ãŸDocker Desktop for Windowsã‚’ä½¿ã£ãŸWSLä¸Šã§ã®å‘¼ã³å‡ºã—ã€‚

ãƒ‡ã‚£ã‚¹ãƒˆãƒ­ãŒ1ã¤ã—ã‹å…¥ã£ã¦ã„ãªã„å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ‡ã‚£ã‚¹ãƒˆãƒ­ã«ã¯è‡ªå‹•ã§WSLã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ãŒç™ºå‹•ã™ã‚‹ã€‚

ã—ã‹ã—ã€2ã¤ä»¥ä¸Šã®å ´åˆã¯ã€æŒ‡å®šã—ã¦ONã«ã—ãªã„ã¨Docker Desktopã¨ã®é€£æºãŒå–ã‚Œãªã„ã€‚

ã“ã®è¨­å®šã‚’ã™ã‚Œã°WSL2ä¸Šã§ `docker` ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚


## Docker on WSL2
https://docs.docker.com/engine/install/debian/

Docker DesktopãŒæœ‰æ–™åŒ–ã—ãŸã“ã¨ã‚’å—ã‘ã€Dockerã‚’WSL2ã®Debianã¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

ã¾ãšã¯å…¬å¼é€šã‚Šã«ã€‚ãŸã ã—ã€ãã®ã¾ã¾ã§ã¯ `docker run` ã§ããªã„ã€‚WSL2å´ã§å‹•ä½œã—ãªã„ã®ã§ã€è¿½åŠ ã§ä¸‹è¨˜ä½œæ¥­ã™ã‚‹ã€‚

```bash
$ touch /etc/fstab
$ update-alternatives --set iptables /usr/sbin/iptables-legacy
$ service docker start
```

## Docker on WSL2ã¨PhpStormã‚’æ¥ç¶šã™ã‚‹
Dockerã¸ã¯TCPæ¥ç¶šã§ããã†ãªæ„Ÿã˜ã ã‘ã©ã€è¨­å®šã‚’ã—ã¦ã‚‚ç¹‹ãŒã‚‰ãªã‹ã£ãŸã€‚ãã“ã§ã„ã£ãŸã‚“æ‰‹è»½ã«SSHã§æ¥ç¶šã™ã‚‹ã€‚

```bash
$ sudo apt install openss-server
$ sudo vim /etc/ssh/sshd_config
# é©å½“ã«ãƒãƒ¼ãƒˆã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’å¤‰ãˆã‚‹
$ sudo service ssh start
```
ä½•ã‹ã—ã‚‰ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã¯ã‚ã‚Šãã†ã ãŒã€ã¨ã‚Šã‚ã‘æ¥ç¶šãŒé…ã„ãªã©ã¯æ„Ÿã˜ã‚‰ã‚Œãªã„ã®ã§å¤§ä¸ˆå¤«ãã†ã€‚

ã‚ã¨ã¯PhpStormã® `File | Settings | Build, Execution, Deployment | Docker` ã‹ã‚‰Dockerã¸ã®æ¥ç¶šã«SSHã‚’é¸æŠã€‚

## Docker on WSL2ã¨PhpStormã®tcpæ¥ç¶š
ä¸Šã§ç¹‹ãŒã‚‰ãªã‹ã£ãŸã¨æ›¸ã„ãŸã‘ã‚Œã©ã€è¿½è·¡èª¿æŸ»ã—ã¦ç¹‹ãŒã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
```bash
$ mkdir /etc/systemd/system/docker.service.d
$ sudo vim /etc/systemd/system/docker.service.d/override.conf
```
```ini
[Service]
ExecStart=
ExecStart=/usr/bin/dockerd -H fd:// -H tcp://0.0.0.0:2375
```
```bash
$ sudo vim /etc/docker/daemon.json
```
```json
{"hosts": ["tcp://127.0.0.1:2375", "unix:///var/run/docker.sock"]}
```
```bash
$ sudo service docker restart
```

æœ€å¾Œã«ã€PhpStormã® `File | Settings | Build, Execution, Deployment | Docker` ã‹ã‚‰ `TCP Socker` ã‚’é¸æŠã€‚  
`Engine API URL` ã«ã¯ `http://localhost:2375` ã‚’è¨­å®šã€‚

æ­£ç›´ãªã«ã‚’ã‚„ã£ã¦ã„ã‚‹ã‹ã‚µãƒƒãƒ‘ãƒªåˆ†ã‹ã‚‰ãªã„â€¦â€¦ã€‚ã²ã¨ã¾ãšSSHã§ã„ã„ã‹ãªã€‚

## ä»¥ä¸Š
ä»Šå¾Œã¾ãŸä½•ã‹ã‚ã‚Œã°éšæ™‚æ›´æ–°äºˆå®šã€‚
